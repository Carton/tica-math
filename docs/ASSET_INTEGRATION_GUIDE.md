# 素材集成指南

## 概述

本指南详细说明如何为数学侦探游戏添加和集成各种素材资源，包括图像、音频、动画等。游戏已经为素材集成做了充分的准备工作，包含了完整的素材管理系统。

## 素材管理系统

### 1. 素材配置系统

游戏使用了完整的素材配置系统，位于 `src/game/config/AssetConfig.ts`：

```typescript
export interface GameAssets {
  backgrounds: { /* 背景图像配置 */ }
  character: { /* 角色素材配置 */ }
  ui: { /* UI元素配置 */ }
  audio: { /* 音频配置 */ }
  animations: { /* 动画配置 */ }
}
```

### 2. 素材管理器

`AssetManager` 类负责所有素材的加载、管理和使用：

- **预加载管理**: 自动预加载所有配置的素材
- **回退机制**: 素材加载失败时自动使用基础图形元素
- **音频管理**: 背景音乐和音效的播放控制
- **动画管理**: Sprite动画的创建和管理

## 素材文件结构

```
assets/
├── backgrounds/
│   ├── main-bg.png          # 主背景
│   ├── question-note.png    # 题目便签背景
│   └── pause-overlay.png    # 暂停遮罩
├── characters/
│   └── tica/
│       ├── idle.png        # 待机状态
│       ├── thinking.png    # 思考状态
│       ├── happy.png       # 开心状态
│       └── surprised.png   # 惊讶状态
├── ui/
│   ├── buttons/
│   │   ├── true-btn.png    # 真相按钮
│   │   ├── false-btn.png   # 伪证按钮
│   │   ├── pause-btn.png   # 暂停按钮
│   │   └── menu-btn.png    # 菜单按钮
│   ├── tools/
│   │   ├── magnify.png     # 放大镜工具
│   │   ├── time-slow.png   # 时间慢走工具
│   │   └── insight.png     # 思维闪电工具
│   └── icons/
│       ├── timer.png       # 计时器图标
│       ├── progress.png    # 进度条图标
│       └── clue.png        # 线索图标
├── audio/
│   ├── background-music.mp3    # 背景音乐
│   └── effects/
│       ├── correct.mp3        # 正确答案音效
│       ├── wrong.mp3          # 错误答案音效
│       ├── tool-use.mp3       # 工具使用音效
│       ├── pause.mp3          # 暂停音效
│       └── button-click.mp3   # 按钮点击音效
└── animations/
    ├── feedback/
    │   ├── correct.png        # 正确反馈动画
    │   └── wrong.png          # 错误反馈动画
    └── tools/
        ├── magnify.png        # 放大镜工具动画
        ├── time-slow.png      # 时间慢走动画
        └── insight.png        # 思维闪电动画
```

## 素材规格要求

### 图像素材

#### 背景图像
- **主背景**: 1920x1080px 或更高分辨率
- **题目便签**: 400x200px，支持透明背景
- **暂停遮罩**: 1920x1080px，半透明黑色遮罩

#### UI按钮
- **标准按钮**: 200x60px
- **暂停按钮**: 40x40px
- **工具图标**: 48x48px

#### 角色精灵
- **角色图像**: 120x120px 或更大
- **建议提供多种状态**: idle, thinking, happy, surprised

#### 动画素材
- **反馈动画**: 64x64px每帧，8帧动画
- **工具动画**: 128x128px每帧，16帧循环动画

### 音频素材

#### 背景音乐
- **格式**: MP3 或 OGG
- **时长**: 建议2-3分钟循环
- **音量**: 适中的背景音量

#### 音效
- **格式**: MP3 或 OGG
- **时长**: 建议1-3秒
- **音量**: 较背景音乐稍响

## 集成步骤

### 第1步：准备素材文件

1. 按照上述文件结构创建素材目录
2. 将素材文件放置到对应位置
3. 确保文件名与配置文件中的名称一致

### 第2步：测试素材加载

游戏启动时会自动尝试加载所有素材。如果素材不存在，会自动回退到基础图形元素。

检查浏览器控制台，确认：
- 没有素材加载错误
- 回退警告信息（如果有）
- 音频播放是否正常

### 第3步：调整素材配置

如果需要自定义素材路径或添加新素材，编辑 `AssetConfig.ts`：

```typescript
export const CUSTOM_ASSETS: GameAssets = {
  backgrounds: {
    main: 'assets/backgrounds/custom-bg.png',
    // ... 其他配置
  },
  // ... 其他素材配置
}
```

### 第4步：性能优化

1. **图片压缩**: 使用 WebP 格式减少文件大小
2. **音频压缩**: 合理的比特率和采样率
3. **精灵图**: 考虑将小图标合并为精灵图
4. **懒加载**: 大型素材按需加载

## 常见问题解决

### 素材加载失败
- **检查文件路径**: 确保路径与配置文件一致
- **检查文件名**: 确保文件名大小写正确
- **查看控制台**: 检查具体的错误信息

### 音频播放问题
- **浏览器限制**: 现代浏览器需要用户交互才能播放音频
- **格式兼容性**: 确保音频格式兼容目标浏览器
- **文件大小**: 过大的音频文件可能导致加载延迟

### 显示问题
- **分辨率适配**: 确保素材适配不同屏幕分辨率
- **透明背景**: PNG素材需要正确的透明通道
- **缩放失真**: 使用适当的图像尺寸避免模糊

## 开发建议

1. **渐进式集成**: 先集成关键素材，再逐步添加装饰性素材
2. **版本控制**: 将素材文件纳入版本控制，但考虑使用Git LFS管理大文件
3. **测试多平台**: 在不同设备和浏览器上测试素材显示效果
4. **性能监控**: 使用浏览器开发者工具监控素材加载性能

## 示例：添加新角色动画

假设要添加一个新的"庆祝"角色状态：

1. **准备素材**: `assets/characters/tica/celebrate.png`
2. **更新配置**: 在 `AssetConfig.ts` 中添加新状态
3. **创建动画**: 在 `AssetManager` 中添加动画创建代码
4. **使用动画**: 在游戏逻辑中调用角色状态切换

```typescript
// 在 AssetConfig.ts 中添加
character: {
  tica: {
    // ... 现有状态
    celebrate: 'assets/characters/tica/celebrate.png'
  }
}

// 在游戏逻辑中使用
character.play('celebrate-animation')
```

## 总结

数学侦探游戏的素材系统设计灵活且可扩展，支持完整的素材集成工作流。通过合理的文件组织、错误处理和性能优化，可以轻松为游戏添加丰富的视觉和音频效果，提升游戏体验。