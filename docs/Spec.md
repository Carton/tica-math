

* * *

### **游戏规格说明书：【Tica 侦探事务所：数字谜案】**

#### **1. 游戏概述 (Game Overview)**

* **游戏名称:** Tica 侦探事务所：数字谜案 (Tica Detective Agency: The Number Mysteries)

* **核心理念:** 这是一款为8-10岁儿童设计的游戏化学习应用。玩家将扮演小侦探“Tica”，通过快速判断数学等式的正误来“破解案件”，在充满乐趣的侦探故事中，锻炼并掌握多种心算及快速验算的技巧。

* **学习目标:**

  1. **核心:** 提升对两位数及三位数加、减、乘、除运算的快速验算能力。

  2. **策略:** 引导孩子学习并应用“估算”、“尾数法”、“奇偶性”、“弃九法”等多种高效的验算策略。

* **技术平台:** 网页端 (PC/平板浏览器)，使用 **Phaser.js** 游戏框架进行开发。
  * **引擎版本:** Phaser 3.90.x（长期维护分支，API 稳定）。
  * **构建形态:** ESM + Vite（或等价打包器），支持现代浏览器与热更新。
  * **分辨率/缩放:** 基准 1280×720，`ScaleManager` 采用 `FIT + CENTER_BOTH`，保持宽高比并自动居中，监听 `scale.resize` 自适配 UI。
  * **UI 分层:** `UIScene` 覆盖渲染于 `GameScene` 之上，避免相机移动影响界面元素；UI 与游戏逻辑通过事件总线解耦通信。
  * **资源:** 优先使用 Texture Atlas / Multi-Atlas；字体通过 `FontFile` 直接加载 TTF/OTF；音频区分 BGM 与 SFX 两类声道。

* * *

#### **2. 核心游戏循环 (Core Gameplay Loop)**

玩家的每一次游戏体验都遵循以下循环：

1. **【接取案件】:** 在主界面点击“开始破案”，进入一个根据当前进度动态生成的“案件”（即关卡）。

2. **【搜集线索】:** 进入关卡后，游戏会连续呈现10道数学计算题（“线索”）。

3. **【判断真伪】:** 针对每一道题，玩家必须在规定时间内点击【真相】(True) 或【伪证】(False) 按钮。

4. **【即时反馈】:** 系统立刻给予生动的声光效反馈，告知判断是否正确。

5. **【使用道具】:** 在遇到困难时，玩家每关可以使用最多3次“侦探工具”。

6. **【案件总结】:** 完成10道题后，进入结算界面，根据正确率和用时进行评级，判断“案件是否告破”。

7. **【获得荣誉】:** 成功破案后，玩家会获得“侦探徽章”和经验值，用于提升侦探等级和解锁新内容。

* * *

#### **3. 游戏化与主题设计 (Gamification & Thematic Design)**

这是让游戏变得有趣的关键。

**A. 故事背景与角色**

* **世界观:** 在一座名为“算术市 (Arithmos)”的智慧城市里，出现了一个神秘的捣蛋鬼——**“谬误教授” (Professor Malcalc)**。他不会搞破坏，但特别喜欢在城市的各个角落留下看似正确却暗藏错误的数学便签，制造混乱。

* **玩家角色:** 玩家扮演小侦探 **Tica**，她是唯一能快速识破“谬误教授”所有诡计的天才。

**B. 主要界面**

* **主界面 (侦探事务所):**

  * **核心功能:** 包含一个醒目的“开始破案”按钮，以及通往“侦探手册”和“荣誉墙”的入口。

  * **侦探手册:** Tica的办案核心。这里收录了您提供的所有【侦探秘籍】。玩家可以随时查阅。

  * **荣誉墙:** 展示玩家在各个案件中获得的“侦探徽章”，带来满满的成就感。

* **关卡界面 (案发现场):**

  * **视觉风格:** 模拟一个侦探的调查桌面。

  * **线索区域:** 屏幕中央，一张便签纸上写着数学等式，如 `145 + 289 = 434`。

  * **判断工具:** 题目下方是两个醒目的印章按钮：绿色的【真相】和红色的【伪证】。

  * **倒计时器:** 一个正在燃烧的导火索或者一个复古的计时器，为玩家带来适度的紧迫感。

  * **进度条:** 清晰地显示“线索 3/10”，让玩家了解进度。

  * **侦探工具箱:** 屏幕一角放置着3个道具的图标。

**C. 反馈与激励**

* **即时反馈:**

  * **正确:** 玩家点击【真相】（当等式正确时），屏幕上会盖下一个大大的“证据确凿”的印章，伴随清脆的“咔哒”声，题目变绿。

  * **错误:** 玩家点击了错误选项，屏幕会浮现“这是伪证！”的红色字样，便签纸被划掉，并伴有“唰”的划纸声。

* **关卡结算:**

  * **成功 (正确率 ≥ 80%):** 出现“案件告破！”的庆祝动画，Tica将“谬误教授”的头像贴在破案板上，并颁发徽章。

  * **失败 (正确率 < 80%):** 出现“让教授逃跑了！”的动画，并鼓励“Tica侦探，整理线索，我们再来一次！”。

* * *

#### **4. 关卡设计与题目生成 (Level Design & Content Generation)**

**A. 关卡设计：无尽的挑战 (Level Design: Endless Challenge)**

游戏将采用**程序化生成、难度递增**的无尽关卡模式，而非固定的、主题鲜明的关卡结构。目标是创造一种“润物细无声”的学习体验，让玩家在持续的挑战中自然成长。

*   **难度递增机制:**
    *   游戏的核心是一个**难度积分 (Difficulty Score)**，从 Level 1 开始，每过一关，积分都会少量增加。
    *   这个积分将决定题目生成的各项参数：
        1.  **数字范围:** 从个位数 (1-9) 逐步过渡到两位数 (10-99)，再到三位数 (100-999)。
        2.  **运算复杂度:**
            *   初期以加减法为主。
            *   随着积分增加，逐渐提高乘除法出现的概率。
            *   更高积分时，出现三个数字的混合运算 (如 `12 + 5 * 10`)。
        3.  **时间限制:** 初始时间较为宽裕，随着积分增加而略微缩短，鼓励玩家提高反应速度。

*   **隐性教学引导:**
    *   **前序关卡 (Level 1-5):** 在这些初始关卡中，游戏会在题目出现时，主动在界面下方提示区展示与题目类型高度相关的“侦探秘籍”。例如，面对 `34 + 52 = 85`，会自动提示“破案口诀：别管前面多复杂，先看尾巴抓一抓！”。
    *   **后续关卡:** 主动提示会消失，玩家需要依靠自己学到的知识或使用道具来解决问题。

*   **难度调整接口 (Tuning Interface):**
    *   `DifficultyManager` 模块将负责管理难度曲线。
    *   需要提供一个简单的配置文件（如 JSON），允许方便地调整难度增长的速度。例如，可以调整“每关增加多少难度积分”、“多少积分开始出现乘法”、“三位数运算的最低积分要求”等，以便根据孩子的实际情况进行微调。

**B. 题目生成逻辑 (Code Agent 注意)**

* **模块化:** `QuestionGenerator` 必须是一个独立的模块，与游戏主循环解耦。

* **生成流程:**

  1. 根据当前关卡的难度配置，确定难度范围（如：两位数加法）和可能考察的“秘籍”（如：“尾数法”）。

  2. 随机生成一个**正确**的等式。

  3. 50%的概率直接使用这个正确等式作为题目。

  4. 50%的概率需要制造一个**错误**等式。制造错误时，**必须有策略性**：

     * **非随机错误:** 不要随机生成一个数字，而是根据本关考察的“秘籍”来制造“高仿真伪证”。

     * **举例:** 若考察“尾数法”，正确答案是 `22+33=55`，则错误的题目应为 `22+33=54` 或 `22+33=56`，而不是 `22+33=999`。

* **数据结构:** 生成的每个题目对象应包含：

  * `questionString`: "22 + 33 = 54"

  * `isTrue`: `false`

  * `targetSkill`: "尾数追踪术" _(这个字段至关重要，用于关联道具提示)_

* * *

#### **5. 侦探道具系统 (Detective Tools System)**

每关可使用3次道具（可以是同一种用3次，也可以是每种用1次）。道具的设计核心是**“启发思路，而非给出答案”**。

1. **真相放大镜 (Magnifying Glass of Truth)**

   * **效果:** 点击使用后，游戏会根据题目的 `targetSkill` 字段，给出动态视觉提示和文字口诀。

   * **举例:**

     * 如果 `targetSkill` 是“尾数追踪术”，放大镜会在所有数字的**个位数**上画一个圈，并显示口诀：“别管前面多复杂，先看尾巴抓一-抓！”

     * 如果 `targetSkill` 是“估算神功”，它会在题目上方显示约等于的数字，如 `98 + 199` 上方显示 `(约100) + (约200)`，并显示口诀。

2. **时间慢走怀表 (Time-Slowing Pocket Watch)**

   * **效果:** 最直接的辅助。使用后，当前这道题的倒计时器立刻增加10秒。

3. **思维闪电 (Flash of Insight)**

   * **效果:** 提供一个聚焦问题核心的“是/非”提示。它不会告诉玩家这道题是对是错，但会验证一个关键环节。

   * **举例:** 对于题目 `123 + 457 = 581`，使用此道具后，会弹出一个提示：“Tica灵光一闪：这道题的**尾数**计算是**错误**的！”。这能极大地引导孩子的思考方向。

* * *
