<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="page-title">Tica 侦探事务所：数字谜案</title>
    <link rel="icon" type="image/png" href="/favicon.png" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="theme-color" content="#0b1021" />
  </head>
  <body style="margin:0;background:#0b1021;color:#fff;">
    <div id="game"></div>
    <script type="module" src="./main.ts"></script>

    <!-- 开发环境调试面板 -->
    <div id="debug-panel" style="display:none; position:fixed; top:10px; right:10px; background:rgba(0,0,0,0.8); color:white; padding:15px; border-radius:8px; font-family:monospace; font-size:12px; z-index:9999; min-width:200px;">
      <h4 id="debug-panel-title" style="margin:0 0 10px 0; color:#4CAF50;">🎮 游戏调试面板</h4>
      <div style="margin-bottom:10px;">
        <label id="debug-set-level" style="display:block; margin-bottom:5px;">设置关卡:</label>
        <input type="number" id="debug-level" value="1" min="1" max="100" style="width:100%; padding:5px;">
        <button id="debug-apply" onclick="applyDebugLevel()" style="width:100%; margin-top:5px; padding:5px; background:#4CAF50; color:white; border:none; border-radius:3px; cursor:pointer;">应用</button>
      </div>
            <div style="margin-bottom:10px;">
        <button id="debug-reset" onclick="resetDebugGame()" style="width:100%; padding:5px; background:#f44336; color:white; border:none; border-radius:3px; cursor:pointer;">重置游戏</button>
      </div>
      <div>
        <button id="debug-hide" onclick="toggleDebugPanel()" style="width:100%; padding:5px; background:#666; color:white; border:none; border-radius:3px; cursor:pointer;">隐藏面板</button>
      </div>
    </div>

    <script>
      // 调试面板功能
      function applyDebugLevel() {
        const level = parseInt(document.getElementById('debug-level').value);
        if (window.DebugHelper && window.DebugHelper.setLevel(level)) {
          setTimeout(() => window.location.reload(), 100);
        }
      }

      // addDebugTools已移除 - 调试模式下道具无限

      function resetDebugGame() {
        const confirmText = window.Strings ? window.Strings.debug.confirm_reset : '确定要重置游戏吗？';
        if (confirm(confirmText)) {
          if (window.DebugHelper && window.DebugHelper.resetGame()) {
            setTimeout(() => window.location.reload(), 100);
          }
        }
      }

      function toggleDebugPanel() {
        const panel = document.getElementById('debug-panel');
        panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
      }

      // 更新页面文本为当前语言
      function updatePageText() {
        if (!window.Strings) return;

        // 更新页面标题
        document.getElementById('page-title').textContent = window.Strings.ui.title;

        // 更新调试面板文本
        const debug = window.Strings.debug;
        document.getElementById('debug-panel-title').textContent = debug.panel_title;
        document.getElementById('debug-set-level').textContent = debug.set_level;
        document.getElementById('debug-apply').textContent = debug.apply;
        document.getElementById('debug-reset').textContent = debug.reset_game;
        document.getElementById('debug-hide').textContent = debug.hide_panel;
      }

      // 延迟执行初始化任务，等待模块加载完成
      setTimeout(() => {
        updatePageText();

        // 调试模式下显示调试面板
        if (window.DebugHelper && window.DebugHelper.isDebugMode()) {
          document.getElementById('debug-panel').style.display = 'block';
        }
      }, 1000);

      // 快捷键支持
      document.addEventListener('keydown', (e) => {
        // Ctrl+Shift+D 切换调试面板
        if (e.ctrlKey && e.shiftKey && e.key === 'D') {
          e.preventDefault();
          toggleDebugPanel();
        }
        // Ctrl+Shift+L 快速设置关卡
        if (e.ctrlKey && e.shiftKey && e.key === 'L') {
          e.preventDefault();
          const promptText = window.Strings ? window.Strings.debug.enter_level : '输入关卡数 (1-100):';
          const level = prompt(promptText);
          if (level && !isNaN(level)) {
            document.getElementById('debug-level').value = parseInt(level);
            applyDebugLevel();
          }
        }
      });
    </script>
  </body>
</html>
